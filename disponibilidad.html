<!DOCTYPE HTML>
<html>
<head>
	<title>Elección de disponibilidad</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content="Easy Admin Panel Responsive web template, Bootstrap Web Templates, Flat Web Templates, Android Compatible web template, 
	Smartphone Compatible web template, free webdesigns for Nokia, Samsung, LG, SonyEricsson, Motorola web design" />
	<script type="application/x-javascript"> addEventListener("load", 
	function() { setTimeout(hideURLbar, 0); }, false); function hideURLbar(){ window.scrollTo(0,1); } 
	</script>
	 <!-- Bootstrap Core CSS -->
	<link href="css/bootstrap.min.css" rel='stylesheet' type='text/css' />
	<!-- Custom CSS -->
	<link href="css/styleDisponibilidad.css" rel='stylesheet' type='text/css' />
	<link rel="stylesheet" href="css/styleConfirmacion.css" type="text/css" media="all" />
	
	<!-- jQuery -->
	<script src="js/jquery-1.10.2.min.js"></script>
	<!-- Placed js at the end of the document so the pages load faster -->

</head> 
   
 <body class="sticky-header left-side-collapsed">

    <section>
        
    <!-- main content start-->
		<div>	
			<!-- header-starts -->
			<div class="header-section">
			 
			<!--notification menu start -->
			<div class="menu-right">
				<div class="user-panel-top"> 
					<div class="profile_details_left">
						<ul class="nofitications-dropdown">
							<h1 style="color: #FCFCFC;">Disponibilidad Docente</h1>	
							<h5 style="color: #7A7676;">Departamento Académico de Ciencias de la Computación</h5>
							<div class="clearfix"></div>	
						</ul>
					</div>
					<div class="profile_details">		
						<ul>
							<li class="dropdown profile_details_drop">
								<div class="profile_img">	
									<span style="background:url(images/1.jpg) no-repeat center"> </span> 
									 <div class="user-name">
										<p>Michael<span style="color: #7A7676;">Profesor</span></p>
									 </div>
									 <i class="lnr lnr-chevron-down"></i>
									 <i class="lnr lnr-chevron-up"></i>
									<div class="clearfix"></div>	
								</div>
							</li>
							<li> 
								<p style="color: #7A7676"> Hora: </p>	
								<time style="color: #7A7676">25 de Enero de 2017</time>
							</li>
							<div class="clearfix"> </div>
						</ul>
					</div>
					<div class="clearfix"></div>
				</div>
			</div>
			<!--notification menu end -->
			</div>
	<!-- //header-ends -->
			<h1>Verificar Datos del Profesor</h1>

			<div class="containerConfirmacion">

				<div class="login">
					
					<label>Código</label>
					<input type="text" class="user" placeholder="Código" disabled id="codigo">
					<label>Apellido Paterno</label>
					<input type="text" class="user" placeholder="Apellidos" disabled id="paterno">
					<label>Nombres</label>
					<input type="text" class="user" placeholder="Nombres" disabled id="nombres">
					<label>Horas - Ciclo Anterior</label>
					<input type="number" class="user" placeholder="Horas" disabled min="0" max="25" id="horas">
					<label>Correo</label>
					<input type="text" class="user" placeholder="Email" id="email">
					<label>Número Celular</label>
					<input type="text" class="user" placeholder="Número Celular" id="phone">

					<div class="clear"></div>
				</div>
			</div>
			<div id="page-wrapper">
				<div class="select_main" id="footerResume">
					<h3>Disponibilidad de Catedra</h3>
					<div id="optionTable">
						<div class="select_div">
							<div class="select_left">
								<label>Escuela:</label>
								<select class="select_tipo" id="escuela_1">
									<option>Seleccione opción</option>
								</select>
							</div>
							<div class="select_right">
								<label>Curso:</label>
								<select class="select_tipo" id="curso_1">
									<option>Seleccione opción</option>
								</select>
							</div>
							<div class="clearfix"></div>
						</div>
					</div>
					<div class="col-sm-4" style="float: right;">
			      		<input type="button" class="botones btnmod" id="addrow" value="Agregar" />
			    	</div>
			    	<div class="clearfix"></div>
				</div>

				<div class="panel-body1">
					<table class="table">
						<thead>
							<tr>
								<th>Numero</th>
								<th>Cursos</th>
								<th>Escuela</th>
							</tr>
						</thead>
						<tbody id="resumeTable">

						</tbody>
					</table>
				</div>
				<div class="graphs">
					 <div class="xs tabls">
						<div class="panel panel-warning" style="opacity: 0.88;">
							<div class="panel-heading">
								<h2>DISPONIBILIDAD DE HORARIO</h2>
								<div class="panel-ctrls"><span class="button-icon has-bg"><i class="ti ti-angle-down"></i></span></div>
							</div>
							<div class="panel-body no-padding" style="display: block;">
								<table class="table table-striped">
									<thead>
										<tr class="" style="background: #1F618D;">
											<th>Horas</th>
											<th>Lunes</th>
											<th>Martes</th>
											<th>Miercoles</th>
											<th>Jueves</th>
											<th>Viernes</th>
											<th>Sabado</th>
										</tr>
									</thead>
									<tbody>
										<tr>
											<td>8 am - 9 am</td>
											<td><div type="checkbox" id="checkbox-1-1" class="regular-checkbox" ></div></td>
											<td><div type="checkbox" id="checkbox-1-2" class="regular-checkbox" ></div></td>
											<td><div type="checkbox" id="checkbox-1-3" class="regular-checkbox" ></div></td>
											<td><div type="checkbox" id="checkbox-1-4" class="regular-checkbox" ></div></td>
											<td><div type="checkbox" id="checkbox-1-5" class="regular-checkbox" ></div></td>
											<td><div type="checkbox" id="checkbox-1-6" class="regular-checkbox" ></div></td>
										</tr>
										<tr>
											<td>9 am - 10 am</td>
											<td><div type="checkbox" id="checkbox-2-1" class="regular-checkbox" ></div></td>
											<td><div type="checkbox" id="checkbox-2-2" class="regular-checkbox" ></div></td>
											<td><div type="checkbox" id="checkbox-2-3" class="regular-checkbox" ></div></td>
											<td><div type="checkbox" id="checkbox-2-4" class="regular-checkbox" ></div></td>
											<td><div type="checkbox" id="checkbox-2-5" class="regular-checkbox" ></div></td>
											<td><div type="checkbox" id="checkbox-2-6" class="regular-checkbox" ></div></td>
										</tr>
										<tr>
											<td>10 am - 11 am</td>
											<td><div type="checkbox" id="checkbox-3-1" class="regular-checkbox" ></div></td>
											<td><div type="checkbox" id="checkbox-3-2" class="regular-checkbox" ></div></td>
											<td><div type="checkbox" id="checkbox-3-3" class="regular-checkbox" ></div></td>
											<td><div type="checkbox" id="checkbox-3-4" class="regular-checkbox" ></div></td>
											<td><div type="checkbox" id="checkbox-3-5" class="regular-checkbox" ></div></td>
											<td><div type="checkbox" id="checkbox-3-6" class="regular-checkbox" ></div></td>
										</tr>
										<tr>
											<td>11 am - 12 pm</td>
											<td><div type="checkbox" id="checkbox-4-1" class="regular-checkbox" ></div></td>
											<td><div type="checkbox" id="checkbox-4-2" class="regular-checkbox" ></div></td>
											<td><div type="checkbox" id="checkbox-4-3" class="regular-checkbox" ></div></td>
											<td><div type="checkbox" id="checkbox-4-4" class="regular-checkbox" ></div></td>
											<td><div type="checkbox" id="checkbox-4-5" class="regular-checkbox" ></div></td>
											<td><div type="checkbox" id="checkbox-4-6" class="regular-checkbox" ></div></td>
										</tr>
										<tr>
											<td>12 pm - 1 pm</td>
											<td><div type="checkbox" id="checkbox-5-1" class="regular-checkbox" ></div></td>
											<td><div type="checkbox" id="checkbox-5-2" class="regular-checkbox" ></div></td>
											<td><div type="checkbox" id="checkbox-5-3" class="regular-checkbox" ></div></td>
											<td><div type="checkbox" id="checkbox-5-4" class="regular-checkbox" ></div></td>
											<td><div type="checkbox" id="checkbox-5-5" class="regular-checkbox" ></div></td>
											<td><div type="checkbox" id="checkbox-5-6" class="regular-checkbox" ></div></td>
										</tr>
										<tr>
											<td>1 pm - 2 pm</td>
											<td><div type="checkbox" id="checkbox-6-1" class="regular-checkbox" ></div></td>
											<td><div type="checkbox" id="checkbox-6-2" class="regular-checkbox" ></div></td>
											<td><div type="checkbox" id="checkbox-6-3" class="regular-checkbox" ></div></td>
											<td><div type="checkbox" id="checkbox-6-4" class="regular-checkbox" ></div></td>
											<td><div type="checkbox" id="checkbox-6-5" class="regular-checkbox" ></div></td>
											<td><div type="checkbox" id="checkbox-6-6" class="regular-checkbox" ></div></td>
										</tr>
										<tr>
											<td>2 pm - 3 pm</td>
											<td><div type="checkbox" id="checkbox-7-1" class="regular-checkbox" ></div></td>
											<td><div type="checkbox" id="checkbox-7-2" class="regular-checkbox" ></div></td>
											<td><div type="checkbox" id="checkbox-7-3" class="regular-checkbox" ></div></td>
											<td><div type="checkbox" id="checkbox-7-4" class="regular-checkbox" ></div></td>
											<td><div type="checkbox" id="checkbox-7-5" class="regular-checkbox" ></div></td>
											<td><div type="checkbox" id="checkbox-7-6" class="regular-checkbox" ></div></td>
										</tr>
										<tr>
											<td>3 pm - 4 pm</td>
											<td><div type="checkbox" id="checkbox-8-1" class="regular-checkbox" ></div></td>
											<td><div type="checkbox" id="checkbox-8-2" class="regular-checkbox" ></div></td>
											<td><div type="checkbox" id="checkbox-8-3" class="regular-checkbox" ></div></td>
											<td><div type="checkbox" id="checkbox-8-4" class="regular-checkbox" ></div></td>
											<td><div type="checkbox" id="checkbox-8-5" class="regular-checkbox" ></div></td>
											<td><div type="checkbox" id="checkbox-8-6" class="regular-checkbox" ></div></td>
										</tr>
										<tr>
											<td>4 pm - 5 pm</td>
											<td><div type="checkbox" id="checkbox-9-1" class="regular-checkbox" ></div></td>
											<td><div type="checkbox" id="checkbox-9-2" class="regular-checkbox" ></div></td>
											<td><div type="checkbox" id="checkbox-9-3" class="regular-checkbox" ></div></td>
											<td><div type="checkbox" id="checkbox-9-4" class="regular-checkbox" ></div></td>
											<td><div type="checkbox" id="checkbox-9-5" class="regular-checkbox" ></div></td>
											<td><div type="checkbox" id="checkbox-9-6" class="regular-checkbox" ></div></td>
										</tr>
										<tr>
											<td>5 pm - 6 pm</td>
											<td><div type="checkbox" id="checkbox-10-1" class="regular-checkbox" ></div></td>
											<td><div type="checkbox" id="checkbox-10-2" class="regular-checkbox" ></div></td>
											<td><div type="checkbox" id="checkbox-10-3" class="regular-checkbox" ></div></td>
											<td><div type="checkbox" id="checkbox-10-4" class="regular-checkbox" ></div></td>
											<td><div type="checkbox" id="checkbox-10-5" class="regular-checkbox" ></div></td>
											<td><div type="checkbox" id="checkbox-10-6" class="regular-checkbox" ></div></td>
										</tr>
										<tr>
											<td>6 pm - 7 pm</td>
											<td><div type="checkbox" id="checkbox-11-1" class="regular-checkbox" ></div></td>
											<td><div type="checkbox" id="checkbox-11-2" class="regular-checkbox" ></div></td>
											<td><div type="checkbox" id="checkbox-11-3" class="regular-checkbox" ></div></td>
											<td><div type="checkbox" id="checkbox-11-4" class="regular-checkbox" ></div></td>
											<td><div type="checkbox" id="checkbox-11-5" class="regular-checkbox" ></div></td>
											<td><div type="checkbox" id="checkbox-11-6" class="regular-checkbox" ></div></td>
										</tr>
										<tr>
											<td>7 pm - 8 pm</td>
											<td><div type="checkbox" id="checkbox-12-1" class="regular-checkbox" ></div></td>
											<td><div type="checkbox" id="checkbox-12-2" class="regular-checkbox" ></div></td>
											<td><div type="checkbox" id="checkbox-12-3" class="regular-checkbox" ></div></td>
											<td><div type="checkbox" id="checkbox-12-4" class="regular-checkbox" ></div></td>
											<td><div type="checkbox" id="checkbox-12-5" class="regular-checkbox" ></div></td>
											<td><div type="checkbox" id="checkbox-12-6" class="regular-checkbox" ></div></td>
										</tr>
										<tr>
											<td>8 pm - 9 pm</td>
											<td><div type="checkbox" id="checkbox-13-1" class="regular-checkbox" ></div></td>
											<td><div type="checkbox" id="checkbox-13-2" class="regular-checkbox" ></div></td>
											<td><div type="checkbox" id="checkbox-13-3" class="regular-checkbox" ></div></td>
											<td><div type="checkbox" id="checkbox-13-4" class="regular-checkbox" ></div></td>
											<td><div type="checkbox" id="checkbox-13-5" class="regular-checkbox" ></div></td>
											<td><div type="checkbox" id="checkbox-13-6" class="regular-checkbox" ></div></td>
										</tr>
										<tr>
											<td>9 pm - 10 pm</td>
											<td><div type="checkbox" id="checkbox-14-1" class="regular-checkbox" ></div></td>
											<td><div type="checkbox" id="checkbox-14-2" class="regular-checkbox" ></div></td>
											<td><div type="checkbox" id="checkbox-14-3" class="regular-checkbox" ></div></td>
											<td><div type="checkbox" id="checkbox-14-4" class="regular-checkbox" ></div></td>
											<td><div type="checkbox" id="checkbox-14-5" class="regular-checkbox" ></div></td>
											<td><div type="checkbox" id="checkbox-14-6" class="regular-checkbox" ></div></td>
										</tr>
									</tbody>
								</table>
							</div>
						</div>
						
					</div>
				</div>

				
			<div class="col-md-4" style="float: right; min-width: 250px;">
		    	<input class="botones " id="submit" type="button" value="Aceptar" >
		    	<input class="botones " id="print" type="button" value="Imprimir" >
		    	<div class="clearfix"></div>
		    </div>
		</div>
		<!--footer section start-->
			<footer>
			   <p>Departamento Académico de Ciencias de la Computación de la <a href="">FISI</a></p>
			</footer>
        <!--footer section end-->
	</section>

<!-- Bootstrap Core JavaScript -->
   <script src="js/bootstrap.min.js"></script>
   <script type="text/javascript">
      $(document).ready(function(){
        if(localStorage.getItem("rol") == null || localStorage.getItem("rol") != 2 || localStorage.getItem("user") == null) {
          window.location.href = "./login.html"; 
        }
        var base_url = "http://54.244.144.252:8080/sidihoWs";

        var user = JSON.parse(localStorage.getItem("user"));
        
        var max = user.docente.cant;

        var counter = 0;
        var horario = {};
        var courses = 1;

        for(var i = 1 ; i <= 7 ; ++i) {
          horario[i] = {};
          for(var j = 1 ; j <= 14 ; ++j) {
            horario[i][j] = false;
          }
        }

        var cursoEscuela = null;
        var complete = {};
        for(var i = 0; i <= 10 ; ++i) {
          complete[i] = [];
        }
        var escuelas = {};
        var cursos = {};

        function bindEvent(id) {
          for(item in complete) {
            if(complete[item].length > 0){
              
              $("#escuela_"+id).append($('<option>',{
                value: item,
                text: escuelas[item].nombre
              }));
            }
          }
          $("#escuela_"+id).change(function(e){
            var selected = this.value;
            $("#curso_"+id).empty();
            for(item in complete[selected]) {
              var curso = complete[selected][item];
              $("#curso_"+id).append($('<option>',{
                value: curso.id,
                text: curso.nombre
              }));
            }
          });
        }

        function loadCursoEscuela() {
          $.ajax({
            url: base_url+'/curso_escuela/',
              type: 'GET',
              success: function (data) {
                  cursoEscuela = data.cursoEscuelas;
                  for(item in data.cursoEscuelas) {
                    complete[cursoEscuela[item].escuela.id].push(cursoEscuela[item].curso);
                    escuelas[cursoEscuela[item].escuela.id] = cursoEscuela[item].escuela;
                    cursos[cursoEscuela[item].curso.id] = cursoEscuela[item].curso;
                  }
                  bindEvent(1);
              }
            });
        }

        function loadDocente() {
            $.ajax({
              url: base_url+'/docente/'+JSON.parse(localStorage.getItem("user")).docente.id,
              type: 'GET',
              success: function (data) {
                  user["docente"] = data.docente;
                  localStorage.setItem("user", JSON.stringify(user));
                  $("#codigo").val(user.docente.codigo);
                  $("#paterno").val(user.docente.lastname);
                  $("#nombres").val(user.docente.firstname);
                  $("#horas").val(user.docente.cant);
                  $("#email").val(user.docente.email);
                  $("#phone").val(user.docente.phone);
                  $("#current").text(user.docente.cant);
                  console.log(user.docente);
                  max = user.docente.cant;

                  if(user.docente.horario == null) {
                    $("#print").addClass("hidden");
                    $("mytable").addClass("hidden");
                    $("resume").removeClass("hidden");

                    $("#optionTable").removeClass("hidden");
                    $("#footerResume").removeClass("hidden");
                    $("#resumeTable").addClass("hidden");
                  }
                  else{
                    $("#submit").addClass("hidden");
			$("#current").text(0);
                    var horarioDia = user.docente.horario["horarioDia"];
                    for(index in horarioDia){
                      var dia = horarioDia[index].dia;
                      for(idx in horarioDia[index].horas){
                        var hora = horarioDia[index].horas[idx].id;
                        $("#checkbox-"+hora+"-"+dia).removeClass("sucess");
                        $("#checkbox-"+hora+"-"+dia).addClass("sucess");
                      }
                    }

                    $("#optionTable").addClass("hidden");
                    $("#footerResume").addClass("hidden");
                    $("#resumeTable").removeClass("hidden");

                    for(var i = 0 ; i < user.docente.cursoEscuela.length ; ++i){
                      var item = user.docente.cursoEscuela[i];
                      console.log(item);
		      $("#resumeTable").append('<tr>');
                      $("#resumeTable").append('<td style="vertical-align: middle;">'+(i+1)+'</td><td><div class="btn-group">'+item.escuela.nombre+'</div></td><td><div class="btn-group">'+item.curso.nombre+'</div></td>')
		      $("#resumeTable").append('</tr>');
                    }
                  }

              },
              statusCode: {
                401: function() {
                  $("#error_container").removeClass("hidden");
                },
                404: function() {
                  alert("Docente no encontrado");
                },
                400: function() {
                  alert("error en datos");
                },
                500: function() {
                  alert("error en servidor");
                }
              }
          });
        }

        $("#print").click(function(e){
          window.print();
        });

        loadCursoEscuela();
        loadDocente();

        $("#submit").click(function(e){
          var binded = [];
          for(var i = 1 ; i <= courses ; ++i) {
            if($("#escuela_"+i).val() == 0 || $("#curso_"+i).val() == 0) {
              alert("Tiene que colocar curso y escuela valida");
              return;
            }
            else {
              for(item in cursoEscuela) {
                if(cursoEscuela[item].escuela.id == $("#escuela_"+i).val() && cursoEscuela[item].curso.id == $("#curso_"+i).val()){
                  binded.push(cursoEscuela[item].id);
                }
              }
            }
          }
          if(counter < user.docente.cant) {
            alert("Tiene que llenar la cantidad de horas exactas");
            return;
          }
          console.log(JSON.stringify(binded));

          var docenteData = {
          	"email"	: $("#email").val(),
          	"phone"	: $("#phone").val()
          };

          $.ajax({
              url: base_url+'/docente/'+user.docente.id,
              type: 'POST',
              contentType: "application/json",
              success: function (data) {
                  console.log(data);
              },
              data: JSON.stringify(docenteData),
              statusCode: {
                401: function() {
                  $("#error_container").removeClass("hidden");
                },
                404: function() {
                  alert("Docente no encontrado");
                },
                400: function() {
                  alert("error en datos de cursos");
                },
                500: function() {
                  alert("error en servidor por cursos");
                }
              }
          });

          var dataCursos = {
            "docente": user.docente.id,
            "cursos": binded
          };

          $.ajax({
              url: base_url+'/curso',
              type: 'POST',
              contentType: "application/json",
              success: function (data) {
                  console.log(data);
              },
              data: JSON.stringify(dataCursos),
              statusCode: {
                401: function() {
                  $("#error_container").removeClass("hidden");
                },
                404: function() {
                  alert("Docente no encontrado");
                },
                400: function() {
                  alert("error en datos de cursos");
                },
                500: function() {
                  alert("error en servidor por cursos");
                }
              }
          });

          var _horario = []
          for(dia in horario) {
            var horas = [];
            var used = false;
            for(hora in horario[dia]) {
              if(horario[dia][hora]) {
                used = true;
                horas.push(hora);
              }
              
            }
            if(!used)continue;
            _horario.push({
              "dia" : dia,
              "hora": horas
            });
          }

          var data = {
            "docente": user.docente.id,
            "horario": _horario
          };

          $.ajax({
              url: base_url+'/horario',
              type: 'POST',
              contentType: "application/json",
              success: function (data) {
                  user["docente"] = data.docente;
                  localStorage.setItem("user", JSON.stringify(user));
                  window.location.reload();
              },
              data: JSON.stringify(data),
              statusCode: {
                401: function() {
                  $("#error_container").removeClass("hidden");
                },
                404: function() {
                  alert("Docente no encontrado");
                },
                400: function() {
                  alert("error en datos de horario");
                },
                500: function() {
                  alert("error en servidor de horario");
                }
              }
          });
        });
      
      $("[data-toggle=tooltip]").tooltip();

      $('.regular-checkbox').click(function() {
        var id      = $(this).attr("id");
        var exp     = id.split("-");
        var hora    = exp[1];
        var dia    = exp[2];
        console.log(id);
        if(user.docente.horario != null)return;
        console.log(id);
        
        if(!$(this).hasClass("sucess")){
          if(counter == max)return;
            counter++;
            $( this ).toggleClass( "sucess" );
            horario[dia][hora] = true;
        }
        else {
          if(counter == 0)return;
          $( this ).toggleClass( "sucess" ); 
          counter--;
          horario[dia][hora] = false;
        }

        $("#current").text(max-counter);
      });

      $("#addrow").on("click", function () {
      	console.log('add');
          var newRow = $("<tr>");
          var cols = "";
          courses++;
          cols += '<div class="select_div"><div class="select_left"><label>Escuela:</label><select class="select_tipo" id="escuela_'+courses+'"><option>Seleccione opción</option></select></div><div class="select_right"><label>Curso:</label><select class="select_tipo" id="curso_'+courses+'"><option>Seleccione opción</option><option>Curso 1</option><option>Curso 2</option></select></div><div class="clearfix"></div></div>';
          
          $("#optionTable").append(cols);
          bindEvent(courses);
      });



      
      });
    </script>
</body>
</html>